{% extends "main/base.html" %}
{% block head_title %}{% if search_query %} Results for '{{search_query}}'{% else %} Search {% endif %} - {{block.super}}{% endblock head_title %}
{% block content %}
{% load static %}
{% load custom_tags %}


<script>
  function toggleCheckboxName(checkbox) {
      if (checkbox.checked) {
          checkbox.removeAttribute('name');
      } else {
          checkbox.setAttribute('name', checkbox.getAttribute('data-name'));
      }
  }
</script>




<div class="bg-white dark:bg-gray-800">
  <div x-data="{ open: false, sectionOpen: { color: false, category: false, size: false } }">
    <!--
      Mobile filter dialog

      Off-canvas filters for mobile, show/hide based on off-canvas filters state.
    -->
    <div x-init="$el.classList.remove('hidden')" class="hidden relative z-50 xl:hidden" role="dialog" aria-modal="true">
      <!--
        Off-canvas menu backdrop, show/hide based on off-canvas menu state.

        Entering: "transition-opacity ease-linear duration-300"
          From: "opacity-0"
          To: "opacity-100"
        Leaving: "transition-opacity ease-linear duration-300"
          From: "opacity-100"
          To: "opacity-0"
      -->
      <div x-show="open" class="z-20 fixed inset-0 bg-black bg-opacity-25 transition-opacity ease-linear duration-300" @click="open = false"></div>

      <div x-show="open" class="fixed inset-0 z-40 flex" x-transition:enter="transition ease-in-out duration-300 transform" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in-out duration-300 transform" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full">
        <!--
          Off-canvas menu, show/hide based on off-canvas menu state.

          Entering: "transition ease-in-out duration-300 transform"
            From: "translate-x-full"
            To: "translate-x-0"
          Leaving: "transition ease-in-out duration-300 transform"
            From: "translate-x-0"
            To: "translate-x-full"
        -->
        <div class="relative ml-auto flex h-full w-full max-w-xs flex-col overflow-y-auto bg-white dark:bg-gray-800 py-4 pb-12 shadow-xl">
          <div class="flex items-center justify-between px-4">
            <h2 class="text-lg font-medium text-gray-900 dark:text-gray-300">Filters</h2>
            <button  @click="open = false" type="button" class="-mr-2 flex h-10 w-10 items-center justify-center rounded-md bg-white dark:bg-gray-800 p-2 text-gray-400 dark:text-gray-500 ">
              <span class="sr-only">Close menu</span>
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <!-- Filters -->
          <form class="mx-5 mt-4 border-t border-gray-200 dark:border-gray-700" method="GET" action="{% url 'search' %}">
            <!-- Hidden input to preserve existing 'q' parameter -->
            <input type="hidden" name="q" value="{{ search_query|default_if_none:'' }}">

            <div class="space-x-2 border-b border-gray-200 dark:border-gray-700 py-4 text-sm font-medium text-gray-900 dark:text-gray-300">
              <button type="submit"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Apply Filters
              </button>
              <a href="{% if search_query %}/search/?q={{ search_query }}{% else %}/search{% endif %}"
              class="px-4 py-2 text-sm font-medium tracking-wide text-gray-800 capitalize transition-colors duration-300 transform bg-gray-200 rounded-lg hover:bg-gray-300 focus:outline-none ">
                Clear
              </a>
            </div>


            {% if visible_categories %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
                <h3 class="-my-3 flow-root">
                    <!-- Expand/collapse section button -->
                    <button @click="sectionOpen.category = !sectionOpen.category" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-category" :aria-expanded="sectionOpen.category">
                        <span class="font-medium text-gray-900 dark:text-gray-300">Category</span>
                        <span class="ml-6 flex items-center">
                            <!-- Expand icon, show/hide based on section open state. -->
                            <svg x-show="!sectionOpen.category" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <!-- Collapse icon, show/hide based on section open state. -->
                            <svg x-show="sectionOpen.category" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </h3>
                <!-- Filter section, show/hide based on section state. -->
                <div x-show="sectionOpen.category" class="pt-6" id="filter-section-category">
                    <div class="space-y-4 max-h-64 overflow-auto">
                      {% for category in visible_categories %}
                      <div class="flex items-center">
                          <input id="filter-category-{{ forloop.counter0 }}" name="category" value="{{ category }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if category in selected_categories %}
                              checked
                          {% endif %}
                          >
                          <label for="filter-category-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ category|slice:":50" }}</label>
                      </div>
                      {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if visible_top_commodities %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
                <h3 class="-my-3 flow-root">
                    <!-- Expand/collapse section button -->
                    <button @click="sectionOpen.topcommodity = !sectionOpen.topcommodity" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-topcommodity" :aria-expanded="sectionOpen.topcommodity">
                        <span class="font-medium text-gray-900 dark:text-gray-300">Highest value commodity</span>
                        <span class="ml-6 flex items-center">
                            <!-- Expand icon, show/hide based on section open state. -->
                            <svg x-show="!sectionOpen.topcommodity" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <!-- Collapse icon, show/hide based on section open state. -->
                            <svg x-show="sectionOpen.topcommodity" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </h3>
                <!-- Filter section, show/hide based on section state. -->
                <div x-show="sectionOpen.topcommodity" class="pt-6" id="filter-section-topcommodity">
                    <div class="space-y-4 max-h-64 overflow-auto">
                      {% for commodity in visible_top_commodities %}
                      <div class="flex items-center">
                          <input id="filter-topcommodity-{{ forloop.counter0 }}" name="topcom" value="{{ commodity }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if commodity in selected_top_commodities %}
                              checked
                          {% endif %}
                          >
                          <label for="filter-topcommodity-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ commodity }}</label>
                      </div>
                      {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}


            {% if visible_manufacturers %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
                <h3 class="-my-3 flow-root">
                    <!-- Expand/collapse section button -->
                    <button @click="sectionOpen.manufacturer = !sectionOpen.manufacturer" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-manufacturer" :aria-expanded="sectionOpen.manufacturer">
                        <span class="font-medium text-gray-900 dark:text-gray-300">Manufacturer</span>
                        <span class="ml-6 flex items-center">
                            <!-- Expand icon, show/hide based on section open state. -->
                            <svg x-show="!sectionOpen.manufacturer" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <!-- Collapse icon, show/hide based on section open state. -->
                            <svg x-show="sectionOpen.manufacturer" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </h3>
                <!-- Filter section, show/hide based on section state. -->
                <div x-show="sectionOpen.manufacturer" class="pt-6" id="filter-section-manufacturer">
                    <div class="space-y-4 max-h-64 overflow-auto">
                      {% for manufacturer in visible_manufacturers %}
                      <div class="flex items-center">
                          <input id="filter-manufacturer-{{ forloop.counter0 }}" name="manufacturer" value="{{ manufacturer }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if manufacturer in selected_manufacturers %}
                              checked
                          {% endif %}
                          >
                          <label for="filter-manufacturer-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ manufacturer|slice:":50" }}</label>
                      </div>
                      {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}



            {% if visible_manufacturer_countries %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
              <h3 class="-my-3 flow-root">
                  <!-- Expand/collapse section button -->
                  <button @click="sectionOpen.manufacturercountry = !sectionOpen.manufacturercountry" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-manufacturer" :aria-expanded="sectionOpen.manufacturercountry">
                      <span class="font-medium text-gray-900 dark:text-gray-300">Manufacturer country</span>
                      <span class="ml-6 flex items-center">
                          <!-- Expand icon, show/hide based on section open state. -->
                          <svg x-show="!sectionOpen.manufacturercountry" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                          </svg>
                          <!-- Collapse icon, show/hide based on section open state. -->
                          <svg x-show="sectionOpen.manufacturercountry" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                          </svg>
                      </span>
                  </button>
              </h3>
              <!-- Filter section, show/hide based on section state. -->
              <div x-show="sectionOpen.manufacturercountry" class="pt-6" id="filter-section-manufacturer">
                  <div class="space-y-4 max-h-64 overflow-auto">
                    {% for country in visible_manufacturer_countries %}
                    <div class="flex items-center">
                        <input id="filter-manufacturer-{{ forloop.counter0 }}" name="mcountry" value="{{ country }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                        {% if country in selected_manufacturer_countries %}
                            checked
                        {% endif %}
                        >
                        <label for="filter-manufacturer-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ country|slice:":50" }}</label>
                    </div>
                    {% endfor %}
                  </div>
              </div>
          </div>
          {% endif %}



          <div class="border-b border-gray-200 dark:border-gray-700 py-6">
            <h3 class="-my-3 flow-root">
                <!-- Expand/collapse section button -->
                <button @click="sectionOpen.price = !sectionOpen.price" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-price" :aria-expanded="sectionOpen.price">
                    <span class="font-medium text-gray-900 dark:text-gray-300">Price change YTD in %</span>
                    <span class="ml-6 flex items-center">
                        <!-- Expand icon, show/hide based on section open state. -->
                        <svg x-show="!sectionOpen.price" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                        </svg>
                        <!-- Collapse icon, show/hide based on section open state. -->
                        <svg x-show="sectionOpen.price" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                        </svg>
                    </span>
                </button>
            </h3>
            <!-- Filter section, show/hide based on section state. -->
            <div x-show="sectionOpen.price" class="pt-6" id="filter-section-price">
              <div class="flex flex-row space-x-10 ">
                <div>
                  <label for="min-range-input" class="sr-only">Labels range min</label>
                  <p class="my-2 text-xs text-gray-500">min</p>
                  <input type="number" name="pchangemin" value="{{pchangemin}}" min="-100.0" step="0.1" class="bg-gray-50 border border-gray-300 text-gray-900 dark:text-gray-300 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
                </div>
                <div>
                  <label for="min-range-input" class="sr-only">Labels range max</label>
                  <p class="my-2 text-xs text-gray-500">max</p>
                  <input type="number" name="pchangemax" value="{{pchangemax}}" min="-100.0" step="0.1" class="bg-gray-50 border border-gray-300 text-gray-900 dark:text-gray-300 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
                </div>  
              </div>

            </div>
        </div>




        <div class="border-b border-gray-200 dark:border-gray-700 py-6">
          <h3 class="-my-3 flow-root">
              <!-- Expand/collapse section button -->
              <button @click="sectionOpen.compro = !sectionOpen.compro" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-compro" :aria-expanded="sectionOpen.compro">
                  <span class="font-medium text-gray-900 dark:text-gray-300">Products/Commodities</span>
                  <span class="ml-6 flex items-center">
                      <!-- Expand icon, show/hide based on section open state. -->
                      <svg x-show="!sectionOpen.compro" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                      </svg>
                      <!-- Collapse icon, show/hide based on section open state. -->
                      <svg x-show="sectionOpen.compro" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                      </svg>
                  </span>
              </button>
          </h3>
          <!-- Filter section, show/hide based on section state. -->
          <div x-show="sectionOpen.compro" class="pt-6" id="filter-section-compro">
              <div class="space-y-4 max-h-64 overflow-auto">

                <div class="flex items-center">
                    <input id="filter-compro-product" name="product" value="show" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                      {% if product_show == 'show' %} checked {% endif%} >
                    <label for="filter-compro-product" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">Products</label>
                </div>

                <div class="flex items-center">
                  <input id="filter-compro-commodity" name="commodity" value="show" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if commodity_show == 'show' %} checked {% endif%}>  
                  <label for="filter-compro-commodity" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">Commodities</label>
              </div>

              </div>
          </div>
      </div>

            

      {% if visible_commodities_price_source %}
      <div class="border-b border-gray-200 dark:border-gray-700 py-6">
        <h3 class="-my-3 flow-root">
            <!-- Expand/collapse section button -->
            <button @click="sectionOpen.compricesource = !sectionOpen.compricesource" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-compricesource" :aria-expanded="sectionOpen.compricesource">
                <span class="font-medium text-gray-900 dark:text-gray-300">Commodity price source</span>
                <span class="ml-6 flex items-center">
                    <!-- Expand icon, show/hide based on section open state. -->
                    <svg x-show="!sectionOpen.compricesource" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>
                    <!-- Collapse icon, show/hide based on section open state. -->
                    <svg x-show="sectionOpen.compricesource" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                    </svg>
                </span>
            </button>
        </h3>
        <!-- Filter section, show/hide based on section state. -->
        <div x-show="sectionOpen.compricesource" class="pt-6" id="filter-section-compricesource">
            <div class="space-y-4 max-h-64 overflow-auto">
              {% for price_source in visible_commodities_price_source %}
              <div class="flex items-center">
                  <input id="filter-compricesource-{{ forloop.counter0 }}" name="comps" value="{{ price_source }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if price_source in selected_commodities_price_source %}
                      checked
                  {% endif %}
                  >
                  <label for="filter-compricesource-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ price_source|slice:":50" }}</label>
              </div>
              {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if user_has_products %}
    <div class="border-b border-gray-200 dark:border-gray-700 py-6">
      <h3 class="-my-3 flow-root">
        <div x-data="{ checked: {{ only_user_products_selected|yesno:'true,false' }} }">
          <button type="button" 
              class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500"
              x-on:click="checked = !checked">
              <span class="font-medium text-gray-900 dark:text-gray-300">Show only your products</span>
              <span class="ml-6 flex items-center">
                  <input id="filter-user-products" name="up" value="True" type="checkbox" 
                         class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                         x-model="checked">
              </span>
          </button>
        </div>
      </h3>
    </div>
    {% endif %}

    {% if visible_commodities_type %}
      <div class="border-b border-gray-200 dark:border-gray-700 py-6">
        <h3 class="-my-3 flow-root">
            <!-- Expand/collapse section button -->
            <button @click="sectionOpen.comtype = !sectionOpen.comtype" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-comtype" :aria-expanded="sectionOpen.comtype">
                <span class="font-medium text-gray-900 dark:text-gray-300">Commodity type</span>
                <span class="ml-6 flex items-center">
                    <!-- Expand icon, show/hide based on section open state. -->
                    <svg x-show="!sectionOpen.comtype" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>
                    <!-- Collapse icon, show/hide based on section open state. -->
                    <svg x-show="sectionOpen.comtype"
                    x-init="$el.classList.remove('hidden')"
                    class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                    </svg>
                </span>
            </button>
        </h3>
        <!-- Filter section, show/hide based on section state. -->
        <div x-show="sectionOpen.comtype"
        x-init="$el.classList.remove('hidden')"
        class="hidden pt-6" id="filter-section-comtype">
            <div class="space-y-4 max-h-64 overflow-auto">
              {% for type in visible_commodities_type %}
              <div class="flex items-center">
                  <input id="filter-comtype-{{ forloop.counter0 }}" name="comtype" value="{{ type }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if type in selected_comtype %}
                      checked
                  
                  {% endif %}
                  
                  >
                  <label for="filter-comtype-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ type|slice:":50" }}</label>
              </div>
              {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}


            <!-- More filters -->


          </form>

        </div>
      </div>
    </div>



    <main class="mx-auto max-w-7xl px-4 sm:px-6 xl:px-8">
      <div class="flex items-baseline justify-between border-b border-gray-200 dark:border-gray-700 pb-6 pt-6">

        <h1 class="text-2xl font-bold tracking-tight text-gray-900 dark:text-gray-300">
          {% if search_query %} Results for '{{search_query}}'{% else %}
          
          {% endif %}
        </h1> 

        <div x-data="{ openSort: false }" class="flex items-center">
          <div class="relative inline-block text-left">
            <div>
              <button @click="openSort = !openSort" @click.away="openSort = false" type="button" class="group inline-flex justify-center text-sm font-medium text-gray-700 dark:text-gray-300 dark:hover:text-gray-400 hover:text-gray-900" id="menu-button" aria-expanded="false" aria-haspopup="true">
                Sort
                <svg class="-mr-1 ml-1 h-5 w-5 flex-shrink-0 text-gray-400 dark:text-gray-500  group-hover:text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>

            <!--
              Dropdown menu, show/hide based on menu state.

              Entering: "transition ease-out duration-100"
                From: "transform opacity-0 scale-95"
                To: "transform opacity-100 scale-100"
              Leaving: "transition ease-in duration-75"
                From: "transform opacity-100 scale-100"
                To: "transform opacity-0 scale-95"
            -->
            <div x-show="openSort" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95"
            x-init="$el.classList.remove('hidden')" 
            class="hidden absolute right-0 z-20 mt-2 w-40 origin-top-right rounded-md bg-white dark:bg-gray-800 shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
              <div class="py-1" role="none">
                <a href="{% url 'search' %}?{% build_query sort='default' %}" 
                   class="hover:bg-gray-100 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-300 dark:hover:bg-gray-700 block px-4 py-2 text-sm {% if sort == None or sort == 'default' %}font-medium text-gray-900 dark:text-gray-300 bg-gray-100 dark:bg-gray-700{% else %}text-gray-500{% endif %}" 
                   role="menuitem" tabindex="-1" id="menu-item-0">Default</a>
                <a href="{% url 'search' %}?{% build_query sort='az' %}" 
                   class="hover:bg-gray-100 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-300 dark:hover:bg-gray-700 block px-4 py-2 text-sm {% if sort == 'az' %}font-medium text-gray-900 dark:text-gray-300 bg-gray-100 dark:bg-gray-700{% else %}text-gray-500{% endif %}" 
                   role="menuitem" tabindex="-1" id="menu-item-1">A to Z</a>
                <a href="{% url 'search' %}?{% build_query sort='za' %}" 
                   class="hover:bg-gray-100 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-300 dark:hover:bg-gray-700 block px-4 py-2 text-sm {% if sort == 'za' %}font-medium text-gray-900 dark:text-gray-300 bg-gray-100 dark:bg-gray-700{% else %}text-gray-500{% endif %}" 
                   role="menuitem" tabindex="-1" id="menu-item-2">Z to A</a>
                {% if user.is_authenticated %}
                <a href="{% url 'search' %}?{% build_query sort='price_desc' %}" 
                   class="hover:bg-gray-100 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-300 dark:hover:bg-gray-700 block px-4 py-2 text-sm {% if sort == 'price_desc' %}font-medium text-gray-900 dark:text-gray-300 bg-gray-100 dark:bg-gray-700{% else %}text-gray-500{% endif %}" 
                   role="menuitem" tabindex="-1" id="menu-item-3">Price %: ↑ to ↓</a>
                <a href="{% url 'search' %}?{% build_query sort='price_asc' %}" 
                   class="hover:bg-gray-100 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-300 dark:hover:bg-gray-700 block px-4 py-2 text-sm {% if sort == 'price_asc' %}font-medium text-gray-900 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 {% else %}text-gray-500{% endif %}" 
                   role="menuitem" tabindex="-1" id="menu-item-4">Price %: ↓ to ↑</a>
                {% endif %}
            </div>          
            </div>
          </div>

          {% comment %} <button type="button" class="-m-2 ml-5 p-2 text-gray-400 dark:text-gray-500  hover:text-gray-500 sm:ml-7">
            <span class="sr-only">View grid</span>
            <svg class="h-5 w-5" aria-hidden="true" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.25 2A2.25 2.25 0 002 4.25v2.5A2.25 2.25 0 004.25 9h2.5A2.25 2.25 0 009 6.75v-2.5A2.25 2.25 0 006.75 2h-2.5zm0 9A2.25 2.25 0 002 13.25v2.5A2.25 2.25 0 004.25 18h2.5A2.25 2.25 0 009 15.75v-2.5A2.25 2.25 0 006.75 11h-2.5zm9-9A2.25 2.25 0 0011 4.25v2.5A2.25 2.25 0 0013.25 9h2.5A2.25 2.25 0 0018 6.75v-2.5A2.25 2.25 0 0015.75 2h-2.5zm0 9A2.25 2.25 0 0011 13.25v2.5A2.25 2.25 0 0013.25 18h2.5A2.25 2.25 0 0018 15.75v-2.5A2.25 2.25 0 0015.75 11h-2.5z" clip-rule="evenodd" />
            </svg>
          </button> {% endcomment %}
          <button @click="open = true" type="button" class="-m-2 ml-4 p-2 text-gray-400 dark:text-gray-500  hover:text-gray-500 sm:ml-6 xl:hidden">
            <span class="sr-only">Filters</span>
            <svg class="h-5 w-5" aria-hidden="true" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M2.628 1.601C5.028 1.206 7.49 1 10 1s4.973.206 7.372.601a.75.75 0 01.628.74v2.288a2.25 2.25 0 01-.659 1.59l-4.682 4.683a2.25 2.25 0 00-.659 1.59v3.037c0 .684-.31 1.33-.844 1.757l-1.937 1.55A.75.75 0 018 18.25v-5.757a2.25 2.25 0 00-.659-1.591L2.659 6.22A2.25 2.25 0 012 4.629V2.34a.75.75 0 01.628-.74z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>

      <section aria-labelledby="products-heading" class="pb-24 pt-6">
        <h2 id="products-heading" class="sr-only">Products</h2>

        <div class="grid grid-cols-1 gap-x-8 gap-y-10 xl:grid-cols-4">
          <!-- Filters -->
          <form class="hidden xl:block" method="GET" action="{% url 'search' %}">
            <!-- Hidden input to preserve existing 'q' parameter -->
            <input type="hidden" name="q" value="{{ search_query|default_if_none:'' }}">

            <div class="space-x-2 border-b border-gray-200 dark:border-gray-700 pb-6 text-sm font-medium text-gray-900 dark:text-gray-300">
              <button type="submit"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Apply Filters
              </button>
              <a href="{% if search_query %}/search/?q={{ search_query }}{% else %}/search{% endif %}"
              class="px-4 py-2 text-sm font-medium tracking-wide text-gray-800 capitalize transition-colors duration-300 transform bg-gray-200 rounded-lg hover:bg-gray-300 focus:outline-none ">
                Clear
              </a>
            </div>


            {% if visible_categories %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
                <h3 class="-my-3 flow-root">
                    <!-- Expand/collapse section button -->
                    <button @click="sectionOpen.category = !sectionOpen.category" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-category" :aria-expanded="sectionOpen.category">
                        <span class="font-medium text-gray-900 dark:text-gray-300">Category</span>
                        <span class="ml-6 flex items-center">
                            <!-- Expand icon, show/hide based on section open state. -->
                            <svg x-show="!sectionOpen.category" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <!-- Collapse icon, show/hide based on section open state. -->
                            <svg x-show="sectionOpen.category"
                            x-init="$el.classList.remove('hidden')"
                            class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </h3>
                <!-- Filter section, show/hide based on section state. -->
                <div x-show="sectionOpen.category"
                x-init="$el.classList.remove('hidden')"
                class="hidden pt-6" id="filter-section-category">
                    <div class="space-y-4 max-h-64 overflow-auto">
                      {% for category in visible_categories %}
                      <div class="flex items-center">
                          <input id="filter-category-{{ forloop.counter0 }}" name="category" value="{{ category }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if category in selected_categories %}
                              checked
                          {% endif %}
                          >
                          <label for="filter-category-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ category|slice:":50" }}</label>
                      </div>
                      {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if visible_top_commodities %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
                <h3 class="-my-3 flow-root">
                    <!-- Expand/collapse section button -->
                    <button @click="sectionOpen.topcommodity = !sectionOpen.topcommodity" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-topcommodity" :aria-expanded="sectionOpen.topcommodity">
                        <span class="font-medium text-gray-900 dark:text-gray-300">Highest value commodity</span>
                        <span class="ml-6 flex items-center">
                            <!-- Expand icon, show/hide based on section open state. -->
                            <svg x-show="!sectionOpen.topcommodity" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <!-- Collapse icon, show/hide based on section open state. -->
                            <svg x-show="sectionOpen.topcommodity"
                            x-init="$el.classList.remove('hidden')"
                            class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </h3>
                <!-- Filter section, show/hide based on section state. -->
                <div x-show="sectionOpen.topcommodity"
                  x-init="$el.classList.remove('hidden')"
                  class="hidden pt-6" id="filter-section-topcommodity">
                    <div class="space-y-4 max-h-64 overflow-auto">
                      {% for commodity in visible_top_commodities %}
                      <div class="flex items-center">
                          <input id="filter-topcommodity-{{ forloop.counter0 }}" name="topcom" value="{{ commodity }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if commodity in selected_top_commodities %}
                              checked
                          {% endif %}
                          >
                          <label for="filter-topcommodity-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ commodity }}</label>
                      </div>
                      {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}


            {% if visible_manufacturers %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
                <h3 class="-my-3 flow-root">
                    <!-- Expand/collapse section button -->
                    <button @click="sectionOpen.manufacturer = !sectionOpen.manufacturer" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-manufacturer" :aria-expanded="sectionOpen.manufacturer">
                        <span class="font-medium text-gray-900 dark:text-gray-300">Manufacturer</span>
                        <span class="ml-6 flex items-center">
                            <!-- Expand icon, show/hide based on section open state. -->
                            <svg x-show="!sectionOpen.manufacturer" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                            </svg>
                            <!-- Collapse icon, show/hide based on section open state. -->
                            <svg x-show="sectionOpen.manufacturer"
                            x-init="$el.classList.remove('hidden')"
                            class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </h3>
                <!-- Filter section, show/hide based on section state. -->
                <div x-show="sectionOpen.manufacturer"
                x-init="$el.classList.remove('hidden')"
                class="hidden pt-6" id="filter-section-manufacturer">
                    <div class="space-y-4 max-h-64 overflow-auto">
                      {% for manufacturer in visible_manufacturers %}
                      <div class="flex items-center">
                          <input id="filter-manufacturer-{{ forloop.counter0 }}" name="manufacturer" value="{{ manufacturer }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                          {% if manufacturer in selected_manufacturers %}
                              checked
                          {% endif %}
                          >
                          <label for="filter-manufacturer-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ manufacturer|slice:":50" }}</label>
                      </div>
                      {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}



            {% if visible_manufacturer_countries %}
            <div class="border-b border-gray-200 dark:border-gray-700 py-6">
              <h3 class="-my-3 flow-root">
                  <!-- Expand/collapse section button -->
                  <button @click="sectionOpen.manufacturercountry = !sectionOpen.manufacturercountry" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-manufacturer" :aria-expanded="sectionOpen.manufacturercountry">
                      <span class="font-medium text-gray-900 dark:text-gray-300">Manufacturer country</span>
                      <span class="ml-6 flex items-center">
                          <!-- Expand icon, show/hide based on section open state. -->
                          <svg x-show="!sectionOpen.manufacturercountry" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                          </svg>
                          <!-- Collapse icon, show/hide based on section open state. -->
                          <svg x-show="sectionOpen.manufacturercountry"
                          x-init="$el.classList.remove('hidden')"
                          class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                          </svg>
                      </span>
                  </button>
              </h3>
              <!-- Filter section, show/hide based on section state. -->
              <div x-show="sectionOpen.manufacturercountry"
              x-init="$el.classList.remove('hidden')"
              class="hidden pt-6" id="filter-section-manufacturer">
                  <div class="space-y-4 max-h-64 overflow-auto">
                    {% for country in visible_manufacturer_countries %}
                    <div class="flex items-center">
                        <input id="filter-manufacturer-{{ forloop.counter0 }}" name="mcountry" value="{{ country }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                        {% if country in selected_manufacturer_countries %}
                            checked
                        {% endif %}
                        >
                        <label for="filter-manufacturer-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ country|slice:":50" }}</label>
                    </div>
                    {% endfor %}
                  </div>
              </div>
          </div>
          {% endif %}



          <div class="border-b border-gray-200 dark:border-gray-700 py-6">
            <h3 class="-my-3 flow-root">
                <!-- Expand/collapse section button -->
                <button @click="sectionOpen.price = !sectionOpen.price" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-price" :aria-expanded="sectionOpen.price">
                    <span class="font-medium text-gray-900 dark:text-gray-300">Price change YTD in %</span>
                    <span class="ml-6 flex items-center">
                        <!-- Expand icon, show/hide based on section open state. -->
                        <svg x-show="!sectionOpen.price" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                        </svg>
                        <!-- Collapse icon, show/hide based on section open state. -->
                        <svg x-show="sectionOpen.price"
                        x-init="$el.classList.remove('hidden')"
                        class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                        </svg>
                    </span>
                </button>
            </h3>
            <!-- Filter section, show/hide based on section state. -->
            <div x-show="sectionOpen.price"
            x-init="$el.classList.remove('hidden')"
            class="hidden pt-6" id="filter-section-price">
              <div class="flex flex-row space-x-10 ">
                <div>
                  <label for="min-range-input" class="sr-only">Labels range min</label>
                  <p class="my-2 text-xs text-gray-500">min</p>
                  <input type="number" name="pchangemin" value="{{pchangemin}}" min="-100.0" step="0.1" class="bg-gray-50 border border-gray-300 text-gray-900 dark:text-gray-300 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
                </div>
                <div>
                  <label for="min-range-input" class="sr-only">Labels range max</label>
                  <p class="my-2 text-xs text-gray-500">max</p>
                  <input type="number" name="pchangemax" value="{{pchangemax}}" min="-100.0" step="0.1" class="bg-gray-50 border border-gray-300 text-gray-900 dark:text-gray-300 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500"/>
                </div>  
              </div>

            </div>
        </div>




        <div class="border-b border-gray-200 dark:border-gray-700 py-6">
          <h3 class="-my-3 flow-root">
              <!-- Expand/collapse section button -->
              <button @click="sectionOpen.compro = !sectionOpen.compro" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-compro" :aria-expanded="sectionOpen.compro">
                  <span class="font-medium text-gray-900 dark:text-gray-300">Products/Commodities</span>
                  <span class="ml-6 flex items-center">
                      <!-- Expand icon, show/hide based on section open state. -->
                      <svg x-show="!sectionOpen.compro" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                      </svg>
                      <!-- Collapse icon, show/hide based on section open state. -->
                      <svg x-show="sectionOpen.compro"
                      x-init="$el.classList.remove('hidden')"
                      class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                          <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                      </svg>
                  </span>
              </button>
          </h3>
          <!-- Filter section, show/hide based on section state. -->
          <div x-show="sectionOpen.compro"
          x-init="$el.classList.remove('hidden')"
          class="hidden pt-6" id="filter-section-compro">
              <div class="space-y-4 max-h-64 overflow-auto">

                <div class="flex items-center">
                    <input id="filter-compro-product" name="product" value="show" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                      {% if product_show == 'show' %} checked {% endif%} >
                    <label for="filter-compro-product" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">Products</label>
                </div>

                <div class="flex items-center">
                  <input id="filter-compro-commodity" name="commodity" value="show" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if commodity_show == 'show' %} checked {% endif%}>  
                  <label for="filter-compro-commodity" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">Commodities</label>
              </div>

              </div>
          </div>
      </div>

            

      {% if visible_commodities_price_source %}
      <div class="border-b border-gray-200 dark:border-gray-700 py-6">
        <h3 class="-my-3 flow-root">
            <!-- Expand/collapse section button -->
            <button @click="sectionOpen.compricesource = !sectionOpen.compricesource" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-compricesource" :aria-expanded="sectionOpen.compricesource">
                <span class="font-medium text-gray-900 dark:text-gray-300">Commodity price source</span>
                <span class="ml-6 flex items-center">
                    <!-- Expand icon, show/hide based on section open state. -->
                    <svg x-show="!sectionOpen.compricesource" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>
                    <!-- Collapse icon, show/hide based on section open state. -->
                    <svg x-show="sectionOpen.compricesource"
                    x-init="$el.classList.remove('hidden')"
                    class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                    </svg>
                </span>
            </button>
        </h3>
        <!-- Filter section, show/hide based on section state. -->
        <div x-show="sectionOpen.compricesource"
        x-init="$el.classList.remove('hidden')"
        class="hidden pt-6" id="filter-section-compricesource">
            <div class="space-y-4 max-h-64 overflow-auto">
              {% for price_source in visible_commodities_price_source %}
              <div class="flex items-center">
                  <input id="filter-compricesource-{{ forloop.counter0 }}" name="comps" value="{{ price_source }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if price_source in selected_commodities_price_source %}
                      checked
                  {% endif %}
                  
                  >
                  <label for="filter-compricesource-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ price_source|slice:":50" }}</label>
              </div>
              {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if user_has_products %}
    <div class="border-b border-gray-200 dark:border-gray-700 py-6">
      <h3 class="-my-3 flow-root">
        <div x-data="{ checked: {{ only_user_products_selected|yesno:'true,false' }} }">
          <button type="button" 
              class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500"
              x-on:click="checked = !checked">
              <span class="font-medium text-gray-900 dark:text-gray-300">Show only your products</span>
              <span class="ml-6 flex items-center">
                  <input id="filter-user-products" name="up" value="True" type="checkbox" 
                         class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                         x-model="checked">
              </span>
          </button>
      </div>
      </h3>
    </div>
    {% endif %}


    {% if visible_commodities_type %}
      <div class="border-b border-gray-200 dark:border-gray-700 py-6">
        <h3 class="-my-3 flow-root">
            <!-- Expand/collapse section button -->
            <button @click="sectionOpen.comtype = !sectionOpen.comtype" type="button" class="flex w-full items-center justify-between bg-white dark:bg-gray-800 py-3 text-sm text-gray-400 dark:text-gray-500  hover:text-gray-500" aria-controls="filter-section-comtype" :aria-expanded="sectionOpen.comtype">
                <span class="font-medium text-gray-900 dark:text-gray-300">Commodity type</span>
                <span class="ml-6 flex items-center">
                    <!-- Expand icon, show/hide based on section open state. -->
                    <svg x-show="!sectionOpen.comtype" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                    </svg>
                    <!-- Collapse icon, show/hide based on section open state. -->
                    <svg x-show="sectionOpen.comtype"
                    x-init="$el.classList.remove('hidden')"
                    class="hidden h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />
                    </svg>
                </span>
            </button>
        </h3>
        <!-- Filter section, show/hide based on section state. -->
        <div x-show="sectionOpen.comtype"
        x-init="$el.classList.remove('hidden')"
        class="hidden pt-6" id="filter-section-comtype">
            <div class="space-y-4 max-h-64 overflow-auto">
              {% for type in visible_commodities_type %}
              <div class="flex items-center">
                  <input id="filter-comtype-{{ forloop.counter0 }}" name="comtype" value="{{ type }}" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  {% if type in selected_comtype %}
                      checked
                  {% endif %}
                  
                  >
                  <label for="filter-comtype-{{ forloop.counter0 }}" class="ml-3 text-sm text-gray-600 dark:text-gray-400 ">{{ type|slice:":50" }}</label>
              </div>
              {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

        <!-- More filters -->




          </form>

          <!-- Product grid -->
          <div class="xl:col-span-3">
            
            <div class="flex flex-col ">


              <!-- Product Section -->
            {% if product_show == 'show' %}
            <section>
              <div>
              <h2 class="text-lg font-semibold tracking-tight text-gray-700 dark:text-gray-300 ">Products</h2>
              </div>
              <div class="mt-6 grid grid-cols-2 gap-x-6 gap-y-10 md:grid-cols-4 2xl:grid-cols-6 ">
                
                {% for product in page %}
                <div class="product-container group relative">
                  <div class="aspect-square overflow-hidden rounded-md bg-gray-200 relative">

                    <img src="{% get_product_image_url product %}" alt="{{product.name}} image" class="h-full w-full object-fill object-center">
                    
                    <!-- Hidden content that appears on hover -->
                    <form method="POST" action="{% url 'change_product_to_project' product.id %}" class="">
                      {% csrf_token %}
                      <div class="absolute inset-0 flex justify-between items-start opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gray-800 bg-opacity-75">
                          
                          <select name="project_id" class="project-select absolute max-w-[100px] top-0 left-0 mt-2 ml-2 px-1 py-1 text-xs bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300  rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 z-10">
                              {% for project in owned_projects %}
                                  <option value="{{ project.id }}">{{ project.name }}</option>
                              {% endfor %}
                              <option value="new">New project</option>
                          </select>
                          
                          <input maxlength="100" type="text" name="new_project_name" required placeholder="" class="new-project-name hidden absolute top-10 left-0 mt-2 ml-2 px-1 py-1 text-xs bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300  rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 z-10" />
                      
                          <button type="submit" 
                                  class="product-button text-white
                                  bg-blue-700 hover:bg-blue-800 
                                  absolute bottom-0 right-0 mb-2 mr-2 px-1 py-1 text-xs rounded-md focus:outline-none focus:ring-2 z-10"
                                  data-product-id="{{ product.id }}">
                              Save
                          </button>
                      </div>
                  </form>
                  </div>
                  <div class="mt-4 flex justify-between">
                    <div>
                      <h3 class="text-xs md:text-sm text-gray-700 dark:text-gray-300 ">
                        <a href="/product/{{product.slug}}" class="font-semibold text-wrap">
                          <span aria-hidden="true" class="absolute inset-0"></span>
                          {{ product.name|slice:":50"|word_break:14}}
                        </a>
                      </h3>
                      <p class="mt-1 text-xs text-gray-600 dark:text-gray-400  text-wrap">{{product.category_1}}</p>
                      <p class="mt-1 text-xs text-gray-400 dark:text-gray-500  text-wrap">{{product.manufacturer_name}}</p>
                    </div>

                        <p class="text-xs font-semibold text-gray-900 dark:text-gray-300">
                            {% if user.is_authenticated %}
                            {% if product.increasefromlastyear %}
                              {% if product.increasefromlastyear > 0 %}
                                <a><span class="text-green-500 font-black">↑</span>{{ product.increasefromlastyear | floatformat:"1" }}%</a>
                              {% elif product.increasefromlastyear < 0 %}
                                <a><span class="text-red-500 font-black">↓</span>{{ product.increasefromlastyear | floatformat:"1" }}%</a>
                              {% elif product.increasefromlastyear == 0 %}
                              <a><span class="text-blue-500 font-black">=</span>{{ product.increasefromlastyear | floatformat:"1" }}%</a>
                              {% endif %}
                              {% endif %}
                              {% else %}
                            <a><span class="text-blue-500 font-black"></span>-%</a>
                            {% endif %}
                        </p>
                  </div>
                </div>
                {% empty %}
                <p class="text-gray-800 dark:text-gray-300">No items found.</p>
                {% endfor %}
          </div>

        <!-- Pagination -->
        <div class="mx-5 flex justify-between pt-10">
            {% if page.has_previous %}
           <a href="?page={{ page.previous_page_number }}&pagec={{ page_commodity.number }}{% if search_query %}&q={{search_query}}{% endif %}{%for manufacturer in selected_manufacturers %}&manufacturer={{manufacturer}}{%endfor%}{%for country in selected_manufacturer_countries %}&mcountry={{country}}{%endfor%}{% for price_source in selected_commodities_price_source %}&comps={{price_source}}{% endfor %}{% for top_commodity in selected_top_commodities%}&topcom={{top_commodity}}{% endfor %}{% if pchangemin %}&pchangemin={{pchangemin}}{% endif %}{% if pchangemax %}&pchangemax={{pchangemax}}{% endif %}{% if sort %}&sort={{sort}}{% endif %}{% if product_show %}&product={{product_show}}{% endif %}{% if commodity_show %}&commodity={{commodity_show}}{% endif %}{% if only_user_products_selected %}&up=True{% endif %}"
              class="px-4 py-2 mx-1 text-gray-700 dark:text-gray-300  transition-colors duration-300 transform bg-white dark:bg-gray-800 rounded-md hover:bg-blue-500 dark:hover:bg-blue-500 hover:text-white dark:hover:text-gray-200">
                <div class="flex items-center -mx-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mx-1 rtl:-scale-x-100" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
                    </svg>
                    <span class="mx-1">Previous</span>
                </div>
            </a>
            {% endif %}


            
            <a class="px-4 py-2 mx-1 bg-blue-500 text-white dark:bg-blue-500 dark:text-gray-200 rounded-md sm:inline">
                {{ page.number }}
            </a>

            {% if page.has_next %}
            <a href="?page={{ page.next_page_number }}&pagec={{ page_commodity.number }}{% if search_query %}&q={{search_query}}{% endif %}{%for manufacturer in selected_manufacturers %}&manufacturer={{manufacturer}}{%endfor%}{%for country in selected_manufacturer_countries %}&mcountry={{country}}{%endfor%}{% for price_source in selected_commodities_price_source %}&comps={{price_source}}{% endfor %}{% for top_commodity in selected_top_commodities%}&topcom={{top_commodity}}{% endfor %}{% if pchangemin %}&pchangemin={{pchangemin}}{% endif %}{% if pchangemax %}&pchangemax={{pchangemax}}{% endif %}{% if sort %}&sort={{sort}}{% endif %}{% if product_show %}&product={{product_show}}{% endif %}{% if commodity_show %}&commodity={{commodity_show}}{% endif %}{% if only_user_products_selected %}&up=True{% endif %}"
              class="px-7 py-2 mx-1 text-gray-700 dark:text-gray-300  transition-colors duration-300 transform bg-white dark:bg-gray-800 rounded-md hover:bg-blue-500 dark:hover:bg-blue-500 hover:text-white dark:hover:text-gray-200">
                <div class="flex items-center -mx-1">
                    <span class="mx-1">Next</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mx-1 rtl:-scale-x-100" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                    </svg>
                </div>
            </a>
            {% endif %}
        </div>
        <hr class="my-6 border-gray-200 dark:border-gray-700 md:my-10" />
      </section>
      {% endif %}


      <!-- Commodity Section -->
      {% if commodity_show == 'show' %}
      <section>
        <div class="">
          <h2 id="commodities-header" class="text-lg font-semibold tracking-tight text-gray-700 dark:text-gray-300 ">Commodities</h2> 
        </div>
        <div class="mt-6 grid grid-cols-2 gap-x-6 gap-y-10 md:grid-cols-4 2xl:grid-cols-6 xl:gap-x-6">
          {% for commodity in page_commodity %}
          <div class="group relative">
            <div class="aspect-square overflow-hidden rounded-md bg-gray-200 relative">
              <img src="{% get_commodity_image_url commodity %}" alt="Product_name" class="h-full w-full object-cover object-center xl:h-full xl:w-full">
              
              <!-- Hidden content that appears on hover -->
              <div class="absolute inset-0 flex justify-between items-start opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gray-800 bg-opacity-75">
                
              </div>
            </div>
            <div class="mt-4 flex justify-between">
              <div>
                <h3 class="text-sm text-gray-700 dark:text-gray-300 ">
                  <a href="/commodity/{{commodity.name}}" class="font-semibold text-wrap">
                    <span aria-hidden="true" class="absolute inset-0"></span>
                    {{commodity.name}}
                  </a>
                </h3>
                <p class="mt-1 text-sm text-gray-400 dark:text-gray-500  text-wrap">
                  {{commodity.price_now|floatformat:2}}
                  {% if commodity.unit != 'Index' %}
                  {{commodity.currency.symbol}}
                  {% endif %}
                  {{commodity.unit}}</p>
              </div>

                  <p class="text-xs font-semibold text-gray-900 dark:text-gray-300">
                    {% if user.is_authenticated %}
                      {% if commodity.increasefromlastyear %}
                        {% if commodity.increasefromlastyear > 0 %}
                          <a><span class="text-green-500 font-black">↑</span>{{ commodity.increasefromlastyear | floatformat:"1" }}%</a>
                        {% elif commodity.increasefromlastyear < 0 %}
                          <a><span class="text-red-500 font-black">↓</span>{{ commodity.increasefromlastyear | floatformat:"1" }}%</a>
                        {% elif commodity.increasefromlastyear == 0 %}
                        <a><span class="text-blue-500 font-black"></span>{{ commodity.increasefromlastyear | floatformat:"1" }}%</a>
                        {% endif %}
                        {% endif %}
                        {% else %}
                        <a><span class="text-blue-500 font-black"></span>-%</a>
                      {% endif %}
                  </p>
            </div>
          </div>
          {% empty %}
          <p class="text-gray-800 dark:text-gray-300">No items found.</p>
          {% endfor %}
          </div>




        <!-- Commodity Pagination -->
        <div class="mx-5 flex justify-between pt-10">
          {% if page_commodity.has_previous %}
         <a href="?pagec={{ page_commodity.previous_page_number }}&page={{ page.number }}{% if search_query %}&q={{search_query}}{% endif %}{%for manufacturer in selected_manufacturers %}&manufacturer={{manufacturer}}{%endfor%}{%for country in selected_manufacturer_countries %}&mcountry={{country}}{%endfor%}{% for price_source in selected_commodities_price_source %}&comps={{price_source}}{% endfor %}{% for top_commodity in selected_top_commodities%}&topcom={{top_commodity}}{% endfor %}{% if pchangemin %}&pchangemin={{pchangemin}}{% endif %}{% if pchangemax %}&pchangemax={{pchangemax}}{% endif %}{% if sort %}&sort={{sort}}{% endif %}{% if product_show %}&product={{product_show}}{% endif %}{% if commodity_show %}&commodity={{commodity_show}}{% endif %}{% if only_user_products_selected %}&up=True{% endif %}"
            class="px-4 py-2 mx-1 text-gray-700 dark:text-gray-300  transition-colors duration-300 transform bg-white dark:bg-gray-800 rounded-md hover:bg-blue-500 dark:hover:bg-blue-500 hover:text-white dark:hover:text-gray-200">
              <div class="flex items-center -mx-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mx-1 rtl:-scale-x-100" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
                  </svg>
                  <span class="mx-1">Previous</span>
              </div>
          </a>
          {% endif %}


          <a class="px-4 py-2 mx-1 bg-blue-500 text-white dark:bg-blue-500 dark:text-gray-200 rounded-md sm:inline">
              {{ page_commodity.number }}
          </a>

          {% if page_commodity.has_next %}
          <a href="?pagec={{ page_commodity.next_page_number }}&page={{ page.number }}{% if search_query %}&q={{search_query}}{% endif %}{%for manufacturer in selected_manufacturers %}&manufacturer={{manufacturer}}{%endfor%}{%for country in selected_manufacturer_countries %}&mcountry={{country}}{%endfor%}{% for price_source in selected_commodities_price_source %}&comps={{price_source}}{% endfor %}{% for top_commodity in selected_top_commodities%}&topcom={{top_commodity}}{% endfor %}{% if pchangemin %}&pchangemin={{pchangemin}}{% endif %}{% if pchangemax %}&pchangemax={{pchangemax}}{% endif %}{% if sort %}&sort={{sort}}{% endif %}{% if product_show %}&product={{product_show}}{% endif %}{% if commodity_show %}&commodity={{commodity_show}}{% endif %}{% if only_user_products_selected %}&up=True{% endif %}"
            class="px-7 py-2 mx-1 text-gray-700 dark:text-gray-300  transition-colors duration-300 transform bg-white dark:bg-gray-800 rounded-md hover:bg-blue-500 dark:hover:bg-blue-500 hover:text-white dark:hover:text-gray-200">
              <div class="flex items-center -mx-1">
                  <span class="mx-1">Next</span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mx-1 rtl:-scale-x-100" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
              </div>
          </a>
          {% endif %}
      </div>
    </section>
    {% endif %}


        </div>
      </section>
    </main>
  </div>
</div>



{% endblock %}