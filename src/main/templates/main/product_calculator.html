<input id="product_id" value="{{product.id}}" required class="hidden" hidden/>
<div class="grid grid-cols-2 gap-5">
{% now "Y-m-d" as current_date %}

<!-- Date 1 Price 1 -->
<div>
    <label for="date1" class="block text-sm text-gray-500 dark:text-gray-300">Date X</label>

    <input type="date" id="date1" min="2019-01-01" max="2029-01-01" value="{{ current_date }}" required class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="price1" class="block text-sm text-gray-500 dark:text-gray-300">Price at Date X</label>

    <input type="number" id="price1" value="100" min="0" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>


<hr class="border-gray-200 dark:border-gray-700 col-span-2">
<p class="text-gray-500 dark:text-gray-300 col-span-2">Weights:</p>
<!-- Instruction -->
<p class="text-gray-500  dark:text-gray-300 text-sm col-span-2">To calculate the final price of a product based on its raw materials and other indicators/commodities, you assign weights to each component representing its relative contribution to the total cost.</p>
<p class="text-gray-500 dark:text-gray-300 text-sm col-span-2">The final price is computed as a weighted sum of the costs of the product's inputs.</p>
    
<!-- Weights -->
<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Product raw materials</label>

    <input type="number" min="0" placeholder="100" value="100" id="product-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Electricity UK</label>

    <input type="number" min="0" placeholder="10" id="electricity-uk-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Labour UK</label>

    <input type="number" min="0" placeholder="20" id="labour-uk-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Inflation UK</label>

    <input type="number" min="0" placeholder="10" id="inflation-uk-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Freight China-Europe</label>

    <input type="number" min="0" placeholder="10" id="freight-china-europe-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>


<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">EU Carbon Permits</label>

    <input type="number" min="0" placeholder="10" id="eu-carbon-permits-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Crude Oil</label>

    <input type="number" min="0" placeholder="10" id="crude-oil-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="weight" class="block text-sm text-gray-500 dark:text-gray-300">Construction labour UK</label>

    <input type="number" min="0" placeholder="5" id="construction-labour-uk-weight" class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>
<!-- Other commodities weights in the future -->


<hr class="border-gray-200 dark:border-gray-700 col-span-2">
<!-- Date 2 Price 2 -->
<div>
    {% load custom_tags %}
    <label for="date2" class="block text-sm text-gray-500 font-semibold dark:text-gray-300">Date Y</label>
    <input type="date" id="date2" value="{{ current_date|add_year|date:'Y-m-d' }}" min="2019-01-01" max="2029-01-01" required class="block  mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-blue-300" />
</div>

<div>
    <label for="price2" class="block text-sm text-gray-500 dark:text-gray-300">Calculated Price at Date Y</label>

    <input disabled type="number" id="price2" class="block cursor-not-allowed mt-2 w-full placeholder-gray-400/70 dark:placeholder-gray-500 rounded-lg border border-gray-200 bg-gray-100 dark:bg-gray-700 px-5 py-2.5 text-gray-700 focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40 dark:border-gray-600  dark:text-gray-300 dark:focus:border-blue-300" />
</div>


</div>

<button  id="calculate-button"  class="mt-5 px-6 py-2 font-medium tracking-wide text-white capitalize transition-colors duration-300 transform bg-blue-600 rounded-lg hover:bg-blue-500 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-80">
    <span id="button-text">Calculate</span>
    <div id="spinner" style="border-top-color:#ffffff;" class="hidden loader ease-linear rounded-full border-4 border-t-4 h-5 w-5"></div>
</button>

<p id="error-message" class="mt-3 text-xs text-red-400"></p>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const calculateButton = document.getElementById('calculate-button');
        const buttonText = document.getElementById('button-text');
        const spinner = document.getElementById('spinner');
    
        function calculate() {
            const data = {
                product_id: document.getElementById('product_id').value || null,
                date1: document.getElementById('date1').value || null,
                price1: parseFloat(document.getElementById('price1').value) || 0,
                date2: document.getElementById('date2').value || null,
                // price2: parseFloat(document.getElementById('price2').value) || 0,
                product_weight: parseFloat(document.getElementById('product-weight').value) || 0,
                electricity_uk_weight: parseFloat(document.getElementById('electricity-uk-weight').value) || 0,
                labour_uk_weight: parseFloat(document.getElementById('labour-uk-weight').value) || 0,
                inflation_uk_weight: parseFloat(document.getElementById('inflation-uk-weight').value) || 0,
                freight_china_europe_weight: parseFloat(document.getElementById('freight-china-europe-weight').value) || 0,
                eu_carbon_permits_weight: parseFloat(document.getElementById('eu-carbon-permits-weight').value) || 0,
                crude_oil_weight: parseFloat(document.getElementById('crude-oil-weight').value) || 0,
                construction_labour_uk_weight: parseFloat(document.getElementById('construction-labour-uk-weight').value) || 0,
            };

            // Show the spinner and disable the button
            buttonText.classList.add('hidden');
            spinner.classList.remove('hidden');
            calculateButton.disabled = true; // Disable button to prevent multiple clicks
    
            fetch('{% url "product_calculate_view" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token if necessary
                },
                body: JSON.stringify(data),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Update the values in the calculator based on the response

                document.getElementById('price2').value = data.price2 || '';
                document.getElementById('error-message').innerText = data.error_message || '';

                /*
                document.getElementById('date1').value = data.date1 || '';
                document.getElementById('price1').value = data.price1 || '';
                document.getElementById('date2').value = data.date2 || '';
                document.getElementById('electricity-uk-weight').value = data.electricity_uk_weight || '';
                document.getElementById('labour-uk-weight').value = data.labour_uk_weight || '';
                document.getElementById('inflation-uk-weight').value = data.inflation_uk_weight || '';
                document.getElementById('freight-china-europe-weight').value = data.freight_china_europe_weight || '';
                document.getElementById('eu-carbon-permits-weight').value = data.eu_carbon_permits_weight || '';
                document.getElementById('crude-oil-weight').value = data.crude_oil_weight || '';
                document.getElementById('construction-labour-uk-weight').value = data.construction_labour_uk_weight || '';
                */
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            })
            .finally(() => {
                // Restore button text and re-enable the button
                buttonText.classList.remove('hidden');
                spinner.classList.add('hidden');
                calculateButton.disabled = false;
            });
        }
    
        calculateButton.addEventListener('click', calculate);
        /*
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener('input', calculate);
        });
        */
    });
    
</script>